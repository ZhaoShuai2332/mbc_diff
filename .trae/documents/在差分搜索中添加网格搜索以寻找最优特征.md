## 目标
- 在现有差分搜索流程中增加“网格搜索”，对一组参数组合进行系统枚举，返回概率最高（或 -log2 概率最小）的差分特征及其路径。

## 评估指标
- 以 `prob`（差分路径的累计概率）为主指标，选择 `prob` 最大的结果；等价地可选 `-log2(prob)` 最小。
- 继续保留现有统计信息：激活 S 盒总数 `actives`、回合路径 `path`。

## 参数网格
- `rounds`: 在区间 `[rmin, rmax]` 内的整数（例如 2..10）。
- `init_mode`: `one_nibble`（当前默认，尝试单个 4bit 差分）与 `all`（尝试所有非零 16bit 差分）。
- 可扩展：若后续需要，还可加入起始差分的稀疏度限制等。

## 代码改动
- 扩展 `diffsearch/bfs_search.py`（d:\projects\mbc16\diffsearch\bfs_search.py:84）命令行：新增 `--rmin --rmax --init` 与 `--save-dir`。
  - 若提供区间，则循环调用现有 `best_characteristic(rounds, init_mode)`（d:\projects\mbc16\diffsearch\bfs_search.py:48），为每个 R 生成一个 `best_R{r}.json`。
  - 汇总产生 `grid_best.json`（记录全局最优）、`grid_all.json`（记录每个 R 的最佳条目）。
- 优化剪枝上界：将当前固定 `0.25` 的上界（d:\projects\mbc16\diffsearch\bfs_search.py:75）改为从 S 盒 DDT 计算的真实 `pmax`（调用 `mbc.sbox.sbox_pmax()`，d:\projects\mbc16\mbc\sbox.py:33），使剪枝更稳健。

## 使用方式
- 示例：`python diffsearch/bfs_search.py --rmin 2 --rmax 10 --init one_nibble --save-dir best_runs/`
- 输出：
  - `best_runs/best_R{r}.json`：每个 R 的最佳路径结果（结构同现有 `best_r4.json`）。
  - `best_runs/grid_all.json`：列表形式汇总各 R 的最佳结果（含 `prob`, `neglog2p`, `actives`）。
  - `best_runs/grid_best.json`：全局最优条目（含其对应 R）。

## 验证流程
- 对 `grid_best.json` 中的最优条目，用 Monte Carlo 验证（d:\projects\mbc16\verify\monte_carlo.py:6）：
  - `python verify/monte_carlo.py --rounds <R> --path best_runs/grid_best.json --trials 262144`
  - 对比打印的经验概率与理论 `prob`（d:\projects\mbc16\verify\monte_carlo.py:31-32）。

## 说明
- 加改均在现有文件内完成，避免新建不必要脚本；沿用现有 JSON 结构与 CLI 风格（d:\projects\mbc16\scripts\run_all.py:15-17）。
- 若后续需要对 MILP 阈值（d:\projects\mbc16\milp\longest_threshold.py:6-23）也做参数网格扫描，可追加一个小循环枚举 `p_exp` 与 `rmax` 并取满足阈值的最大 R。